<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SimpleSwap DEX</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background-color: #f7f8fa;
            font-family: 'Inter', sans-serif;
        }
        .card {
            border-radius: 16px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid #edeef2;
        }
        .nav-tabs .nav-link {
            color: #6c7284;
            font-weight: 500;
        }
        .nav-tabs .nav-link.active {
            color: #3f80ff;
            font-weight: 600;
            border-bottom: 2px solid #3f80ff;
            background: transparent;
        }
        .token-input {
            background-color: #f7f8fa;
            border: 1px solid #edeef2;
            border-radius: 12px;
            padding: 16px;
        }
        .token-select {
            cursor: pointer;
            background-color: #edeef2;
            border-radius: 12px;
            padding: 8px 12px;
            font-weight: 500;
        }
        .btn-primary {
            background-color: #3f80ff;
            border: none;
            border-radius: 12px;
            padding: 12px;
            font-weight: 600;
        }
        .btn-primary:hover {
            background-color: #3772e5;
        }
        .btn-outline-primary {
            border-color: #3f80ff;
            color: #3f80ff;
            border-radius: 12px;
            padding: 12px;
            font-weight: 600;
        }
        .btn-outline-primary:hover {
            background-color: #3f80ff;
            color: white;
        }
        .connect-btn {
            background-color: #3f80ff;
            color: white;
            border-radius: 12px;
            padding: 8px 16px;
            font-weight: 600;
        }
        .disconnect-btn {
            background-color: #ff3f3f;
            color: white;
            border-radius: 12px;
            padding: 8px 16px;
            font-weight: 600;
        }
        .token-modal-item {
            padding: 12px;
            border-radius: 12px;
            cursor: pointer;
        }
        .token-modal-item:hover {
            background-color: #f7f8fa;
        }
    </style>
</head>
<body>
    <div class="container py-4" style="max-width: 500px;">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h5 class="m-0">SimpleSwap</h5>
            <button id="connectWalletBtn" class="connect-btn">Connect Wallet</button>
            <button id="disconnectWalletBtn" class="disconnect-btn d-none">Disconnect</button>
        </div>

        <!-- Tabs -->
        <ul class="nav nav-tabs mb-4" id="dexTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="swap-tab" data-bs-toggle="tab" data-bs-target="#swap" type="button" role="tab">Swap</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="liquidity-tab" data-bs-toggle="tab" data-bs-target="#liquidity" type="button" role="tab">Liquidity</button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content">
            <!-- Swap Tab -->
            <div class="tab-pane fade show active" id="swap" role="tabpanel">
                <div class="card p-3 mb-3">
                    <div class="token-input mb-2">
                        <div class="d-flex justify-content-between mb-2">
                            <span>From</span>
                            <span>Balance: <span id="fromTokenBalance">0</span></span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <input type="number" id="fromAmount" class="form-control border-0 bg-transparent p-0" placeholder="0.0" style="font-size: 24px; font-weight: 500; box-shadow: none;">
                            <div class="token-select" data-bs-toggle="modal" data-bs-target="#tokenModal" data-token="from">
                                <span id="fromTokenSymbol">Select Token</span>
                                <i class="fas fa-chevron-down ms-2"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center my-2">
                        <button id="switchTokensBtn" class="btn btn-light rounded-circle" style="width: 36px; height: 36px;">
                            <i class="fas fa-arrow-down"></i>
                        </button>
                    </div>
                    
                    <div class="token-input">
                        <div class="d-flex justify-content-between mb-2">
                            <span>To</span>
                            <span>Balance: <span id="toTokenBalance">0</span></span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <input type="number" id="toAmount" class="form-control border-0 bg-transparent p-0" placeholder="0.0" style="font-size: 24px; font-weight: 500; box-shadow: none;" readonly>
                            <div class="token-select" data-bs-toggle="modal" data-bs-target="#tokenModal" data-token="to">
                                <span id="toTokenSymbol">Select Token</span>
                                <i class="fas fa-chevron-down ms-2"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button id="swapBtn" class="btn btn-primary w-100" disabled>Swap</button>
                
                <div class="card p-3 mt-3">
                    <div class="d-flex justify-content-between mb-2">
                        <span>Exchange Rate</span>
                        <span id="exchangeRate">-</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span>Price Impact</span>
                        <span id="priceImpact">-</span>
                    </div>
                </div>
            </div>

            <!-- Liquidity Tab -->
            <div class="tab-pane fade" id="liquidity" role="tabpanel">
                <div class="card p-3 mb-3">
                    <div class="token-input mb-3">
                        <div class="d-flex justify-content-between mb-2">
                            <span>Token A</span>
                            <span>Balance: <span id="tokenABalance">0</span></span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <input type="number" id="tokenAAmount" class="form-control border-0 bg-transparent p-0" placeholder="0.0" style="font-size: 24px; font-weight: 500; box-shadow: none;">
                            <div class="token-select" data-bs-toggle="modal" data-bs-target="#tokenModal" data-token="tokenA">
                                <span id="tokenASymbol">Select Token</span>
                                <i class="fas fa-chevron-down ms-2"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center my-2">
                        <i class="fas fa-plus"></i>
                    </div>
                    
                    <div class="token-input mb-3">
                        <div class="d-flex justify-content-between mb-2">
                            <span>Token B</span>
                            <span>Balance: <span id="tokenBBalance">0</span></span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <input type="number" id="tokenBAmount" class="form-control border-0 bg-transparent p-0" placeholder="0.0" style="font-size: 24px; font-weight: 500; box-shadow: none;">
                            <div class="token-select" data-bs-toggle="modal" data-bs-target="#tokenModal" data-token="tokenB">
                                <span id="tokenBSymbol">Select Token</span>
                                <i class="fas fa-chevron-down ms-2"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button id="addLiquidityBtn" class="btn btn-primary w-100" disabled>Add Liquidity</button>
                
                <div class="card p-3 mt-3">
                    <h6 class="mb-3">Your Liquidity Positions</h6>
                    <div id="liquidityPositions">
                        <p class="text-muted text-center">No liquidity positions found</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Token Modal -->
    <div class="modal fade" id="tokenModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Select Token</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="input-group mb-3">
                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                        <input type="text" id="tokenSearch" class="form-control" placeholder="Search token name or paste address">
                    </div>
                    <div id="tokenList">
                        <!-- Tokens will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js"></script>
    <script>
        // Contract ABI and Address
        const contractABI = [
            {
                "inputs": [
                    {"internalType": "address", "name": "tokenA", "type": "address"},
                    {"internalType": "address", "name": "tokenB", "type": "address"},
                    {"internalType": "uint256", "name": "amountA", "type": "uint256"},
                    {"internalType": "uint256", "name": "amountB", "type": "uint256"}
                ],
                "name": "addLiquidity",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {"internalType": "address", "name": "fromToken", "type": "address"},
                    {"internalType": "address", "name": "toToken", "type": "address"},
                    {"internalType": "uint256", "name": "amountIn", "type": "uint256"}
                ],
                "name": "swap",
                "outputs": [{"internalType": "uint256", "name": "amountOut", "type": "uint256"}],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {"internalType": "address", "name": "", "type": "address"},
                    {"internalType": "address", "name": "", "type": "address"}
                ],
                "name": "reserves",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {"internalType": "uint256", "name": "amountIn", "type": "uint256"},
                    {"internalType": "uint256", "name": "reserveIn", "type": "uint256"},
                    {"internalType": "uint256", "name": "reserveOut", "type": "uint256"}
                ],
                "name": "getAmountOut",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "pure",
                "type": "function"
            }
        ];
        
        // Replace with your deployed contract address
        const contractAddress = "0x557Bb8f27FEe8186B5594abED96495255fE634e8";
        
        // Common ERC20 tokens (for demo purposes)
        const commonTokens = [
            { address: "0xToken1Address", symbol: "TOKEN1", name: "Token 1" },
            { address: "0xToken2Address", symbol: "TOKEN2", name: "Token 2" },
            { address: "0xToken3Address", symbol: "TOKEN3", name: "Token 3" }
        ];
        
        // Global variables
        let web3;
        let contract;
        let accounts = [];
        let selectedTokenType = "";
        let fromToken = null;
        let toToken = null;
        let tokenA = null;
        let tokenB = null;
        
        // Initialize the app
        async function init() {
            // Check if MetaMask is installed
            if (typeof window.ethereum !== 'undefined') {
                web3 = new Web3(window.ethereum);
                contract = new web3.eth.Contract(contractABI, contractAddress);
                
                // Event listeners
                document.getElementById('connectWalletBtn').addEventListener('click', connectWallet);
                document.getElementById('disconnectWalletBtn').addEventListener('click', disconnectWallet);
                document.getElementById('fromAmount').addEventListener('input', updateSwapOutput);
                document.getElementById('tokenAAmount').addEventListener('input', updateTokenBAmount);
                document.getElementById('tokenBAmount').addEventListener('input', updateTokenAAmount);
                document.getElementById('swapBtn').addEventListener('click', executeSwap);
                document.getElementById('addLiquidityBtn').addEventListener('click', addLiquidity);
                document.getElementById('switchTokensBtn').addEventListener('click', switchTokens);
                
                // Token modal events
                document.querySelectorAll('.token-select').forEach(btn => {
                    btn.addEventListener('click', function() {
                        selectedTokenType = this.getAttribute('data-token');
                        populateTokenList();
                    });
                });
                
                // Token search
                document.getElementById('tokenSearch').addEventListener('input', populateTokenList);
                
                // Check if already connected
                const connectedAccounts = await web3.eth.getAccounts();
                if (connectedAccounts.length > 0) {
                    accounts = connectedAccounts;
                    updateUI();
                }
            } else {
                alert('Please install MetaMask to use this DEX!');
            }
        }
        
        // Connect to MetaMask
        async function connectWallet() {
            try {
                accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                updateUI();
            } catch (error) {
                console.error("User denied account access", error);
            }
        }
        
        // Disconnect wallet
        function disconnectWallet() {
            accounts = [];
            updateUI();
        }
        
        // Update UI based on connection state
        function updateUI() {
            if (accounts.length > 0) {
                document.getElementById('connectWalletBtn').classList.add('d-none');
                document.getElementById('disconnectWalletBtn').classList.remove('d-none');
                
                // Update balances
                updateBalances();
                
                // Load liquidity positions
                loadLiquidityPositions();
            } else {
                document.getElementById('connectWalletBtn').classList.remove('d-none');
                document.getElementById('disconnectWalletBtn').classList.add('d-none');
                
                // Reset balances
                document.getElementById('fromTokenBalance').textContent = '0';
                document.getElementById('toTokenBalance').textContent = '0';
                document.getElementById('tokenABalance').textContent = '0';
                document.getElementById('tokenBBalance').textContent = '0';
                
                // Disable buttons
                document.getElementById('swapBtn').disabled = true;
                document.getElementById('addLiquidityBtn').disabled = true;
            }
        }
        
        // Update token balances
        async function updateBalances() {
            if (accounts.length === 0) return;
            
            const address = accounts[0];
            
            // Update fromToken balance
            if (fromToken) {
                const balance = await getTokenBalance(fromToken.address, address);
                document.getElementById('fromTokenBalance').textContent = balance;
            }
            
            // Update toToken balance
            if (toToken) {
                const balance = await getTokenBalance(toToken.address, address);
                document.getElementById('toTokenBalance').textContent = balance;
            }
            
            // Update tokenA balance
            if (tokenA) {
                const balance = await getTokenBalance(tokenA.address, address);
                document.getElementById('tokenABalance').textContent = balance;
            }
            
            // Update tokenB balance
            if (tokenB) {
                const balance = await getTokenBalance(tokenB.address, address);
                document.getElementById('tokenBBalance').textContent = balance;
            }
        }
        
        // Get token balance
        async function getTokenBalance(tokenAddress, userAddress) {
            if (tokenAddress === '0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE') {
                // ETH balance
                const balance = await web3.eth.getBalance(userAddress);
                return web3.utils.fromWei(balance, 'ether');
            } else {
                // ERC20 token balance
                const tokenContract = new web3.eth.Contract([
                    {
                        "inputs": [{"internalType": "address", "name": "account", "type": "address"}],
                        "name": "balanceOf",
                        "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                        "stateMutability": "view",
                        "type": "function"
                    }
                ], tokenAddress);
                
                const balance = await tokenContract.methods.balanceOf(userAddress).call();
                return web3.utils.fromWei(balance, 'ether');
            }
        }
        
        // Populate token list in modal
        function populateTokenList() {
            const searchTerm = document.getElementById('tokenSearch').value.toLowerCase();
            const tokenList = document.getElementById('tokenList');
            tokenList.innerHTML = '';
            
            const filteredTokens = commonTokens.filter(token => 
                token.symbol.toLowerCase().includes(searchTerm) || 
                token.name.toLowerCase().includes(searchTerm) ||
                token.address.toLowerCase().includes(searchTerm)
            );
            
            if (filteredTokens.length === 0) {
                tokenList.innerHTML = '<p class="text-muted text-center">No tokens found</p>';
                return;
            }
            
            filteredTokens.forEach(token => {
                const tokenItem = document.createElement('div');
                tokenItem.className = 'token-modal-item d-flex justify-content-between align-items-center';
                tokenItem.innerHTML = `
                    <div>
                        <div class="fw-bold">${token.symbol}</div>
                        <div class="text-muted small">${token.name}</div>
                    </div>
                `;
                
                tokenItem.addEventListener('click', () => {
                    selectToken(token);
                    const modal = bootstrap.Modal.getInstance(document.getElementById('tokenModal'));
                    modal.hide();
                });
                
                tokenList.appendChild(tokenItem);
            });
        }
        
        // Select token
        function selectToken(token) {
            if (selectedTokenType === 'from') {
                fromToken = token;
                document.getElementById('fromTokenSymbol').textContent = token.symbol;
                document.getElementById('fromAmount').value = '';
                document.getElementById('toAmount').value = '';
                updateBalances();
            } else if (selectedTokenType === 'to') {
                toToken = token;
                document.getElementById('toTokenSymbol').textContent = token.symbol;
                document.getElementById('toAmount').value = '';
                updateBalances();
            } else if (selectedTokenType === 'tokenA') {
                tokenA = token;
                document.getElementById('tokenASymbol').textContent = token.symbol;
                document.getElementById('tokenAAmount').value = '';
                document.getElementById('tokenBAmount').value = '';
                updateBalances();
            } else if (selectedTokenType === 'tokenB') {
                tokenB = token;
                document.getElementById('tokenBSymbol').textContent = token.symbol;
                document.getElementById('tokenBAmount').value = '';
                document.getElementById('tokenAAmount').value = '';
                updateBalances();
            }
            
            // Enable buttons if conditions are met
            updateButtonStates();
        }
        
        // Update swap output based on input
        async function updateSwapOutput() {
            const amountIn = document.getElementById('fromAmount').value;
            
            if (!amountIn || parseFloat(amountIn) <= 0 || !fromToken || !toToken) {
                document.getElementById('toAmount').value = '';
                document.getElementById('exchangeRate').textContent = '-';
                document.getElementById('priceImpact').textContent = '-';
                return;
            }
            
            try {
                // Get reserves from the contract
                const reserveIn = await contract.methods.reserves(fromToken.address, toToken.address).call();
                const reserveOut = await contract.methods.reserves(toToken.address, fromToken.address).call();
                
                if (reserveIn <= 0 || reserveOut <= 0) {
                    document.getElementById('toAmount').value = '0';
                    document.getElementById('exchangeRate').textContent = 'No liquidity';
                    document.getElementById('priceImpact').textContent = '-';
                    return;
                }
                
                // Calculate amount out
                const amountInWei = web3.utils.toWei(amountIn, 'ether');
                const amountOutWei = await contract.methods.getAmountOut(amountInWei, reserveIn, reserveOut).call();
                const amountOut = web3.utils.fromWei(amountOutWei, 'ether');
                
                document.getElementById('toAmount').value = amountOut;
                
                // Calculate exchange rate
                const exchangeRate = (amountOut / amountIn).toFixed(6);
                document.getElementById('exchangeRate').textContent = `1 ${fromToken.symbol} = ${exchangeRate} ${toToken.symbol}`;
                
                // Simple price impact calculation (for demo)
                const priceImpact = ((amountIn / (parseFloat(web3.utils.fromWei(reserveIn, 'ether')) + parseFloat(amountOut) / (parseFloat(web3.utils.fromWei(reserveOut, 'ether'))) * 100;
                document.getElementById('priceImpact').textContent = `${priceImpact.toFixed(4)}%`;
                
            } catch (error) {
                console.error("Error calculating swap output:", error);
                document.getElementById('toAmount').value = '';
                document.getElementById('exchangeRate').textContent = '-';
                document.getElementById('priceImpact').textContent = '-';
            }
        }
        
        // Update token B amount based on token A input (for liquidity)
        async function updateTokenBAmount() {
            const amountA = document.getElementById('tokenAAmount').value;
            
            if (!amountA || parseFloat(amountA) <= 0 || !tokenA || !tokenB) {
                document.getElementById('tokenBAmount').value = '';
                return;
            }
            
            try {
                // In a real DEX, this would calculate the optimal amount based on pool ratios
                // For simplicity, we'll just use a 1:1 ratio in this demo
                document.getElementById('tokenBAmount').value = amountA;
            } catch (error) {
                console.error("Error calculating token B amount:", error);
                document.getElementById('tokenBAmount').value = '';
            }
        }
        
        // Update token A amount based on token B input (for liquidity)
        async function updateTokenAAmount() {
            const amountB = document.getElementById('tokenBAmount').value;
            
            if (!amountB || parseFloat(amountB) <= 0 || !tokenA || !tokenB) {
                document.getElementById('tokenAAmount').value = '';
                return;
            }
            
            try {
                // In a real DEX, this would calculate the optimal amount based on pool ratios
                // For simplicity, we'll just use a 1:1 ratio in this demo
                document.getElementById('tokenAAmount').value = amountB;
            } catch (error) {
                console.error("Error calculating token A amount:", error);
                document.getElementById('tokenAAmount').value = '';
            }
        }
        
        // Switch tokens in swap
        function switchTokens() {
            if (!fromToken || !toToken) return;
            
            const tempToken = fromToken;
            fromToken = toToken;
            toToken = tempToken;
            
            document.getElementById('fromTokenSymbol').textContent = fromToken.symbol;
            document.getElementById('toTokenSymbol').textContent = toToken.symbol;
            
            const fromAmount = document.getElementById('fromAmount').value;
            const toAmount = document.getElementById('toAmount').value;
            
            document.getElementById('fromAmount').value = toAmount;
            document.getElementById('toAmount').value = fromAmount;
            
            updateBalances();
        }
        
        // Update button states based on conditions
        function updateButtonStates() {
            // Swap button
            const swapBtn = document.getElementById('swapBtn');
            const fromAmount = document.getElementById('fromAmount').value;
            
            if (fromToken && toToken && fromAmount && parseFloat(fromAmount) > 0 && 
                document.getElementById('toAmount').value && parseFloat(document.getElementById('toAmount').value) > 0) {
                swapBtn.disabled = false;
            } else {
                swapBtn.disabled = true;
            }
            
            // Add liquidity button
            const addLiqBtn = document.getElementById('addLiquidityBtn');
            const tokenAAmount = document.getElementById('tokenAAmount').value;
            const tokenBAmount = document.getElementById('tokenBAmount').value;
            
            if (tokenA && tokenB && tokenAAmount && parseFloat(tokenAAmount) > 0 && 
                tokenBAmount && parseFloat(tokenBAmount) > 0) {
                addLiqBtn.disabled = false;
            } else {
                addLiqBtn.disabled = true;
            }
        }
        
        // Execute swap
        async function executeSwap() {
            if (accounts.length === 0 || !fromToken || !toToken) return;
            
            const fromAmount = document.getElementById('fromAmount').value;
            if (!fromAmount || parseFloat(fromAmount) <= 0) return;
            
            try {
                const amountInWei = web3.utils.toWei(fromAmount, 'ether');
                
                // For ERC20 tokens, we need to approve the contract to spend tokens
                if (fromToken.address !== '0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE') {
                    const tokenContract = new web3.eth.Contract([
                        {
                            "inputs": [
                                {"internalType": "address", "name": "spender", "type": "address"},
                                {"internalType": "uint256", "name": "amount", "type": "uint256"}
                            ],
                            "name": "approve",
                            "outputs": [{"internalType": "bool", "name": "", "type": "bool"}],
                            "stateMutability": "nonpayable",
                            "type": "function"
                        }
                    ], fromToken.address);
                    
                    await tokenContract.methods.approve(contractAddress, amountInWei).send({ from: accounts[0] });
                }
                
                // Execute swap
                await contract.methods.swap(
                    fromToken.address,
                    toToken.address,
                    amountInWei
                ).send({ from: accounts[0] });
                
                alert('Swap executed successfully!');
                
                // Reset inputs and update balances
                document.getElementById('fromAmount').value = '';
                document.getElementById('toAmount').value = '';
                updateBalances();
                
            } catch (error) {
                console.error("Error executing swap:", error);
                alert('Swap failed: ' + error.message);
            }
        }
        
        // Add liquidity
        async function addLiquidity() {
            if (accounts.length === 0 || !tokenA || !tokenB) return;
            
            const amountA = document.getElementById('tokenAAmount').value;
            const amountB = document.getElementById('tokenBAmount').value;
            
            if (!amountA || parseFloat(amountA) <= 0 || !amountB || parseFloat(amountB) <= 0) return;
            
            try {
                const amountAWei = web3.utils.toWei(amountA, 'ether');
                const amountBWei = web3.utils.toWei(amountB, 'ether');
                
                // Approve token A if it's an ERC20
                if (tokenA.address !== '0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE') {
                    const tokenAContract = new web3.eth.Contract([
                        {
                            "inputs": [
                                {"internalType": "address", "name": "spender", "type": "address"},
                                {"internalType": "uint256", "name": "amount", "type": "uint256"}
                            ],
                            "name": "approve",
                            "outputs": [{"internalType": "bool", "name": "", "type": "bool"}],
                            "stateMutability": "nonpayable",
                            "type": "function"
                        }
                    ], tokenA.address);
                    
                    await tokenAContract.methods.approve(contractAddress, amountAWei).send({ from: accounts[0] });
                }
                
                // Approve token B if it's an ERC20
                if (tokenB.address !== '0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE') {
                    const tokenBContract = new web3.eth.Contract([
                        {
                            "inputs": [
                                {"internalType": "address", "name": "spender", "type": "address"},
                                {"internalType": "uint256", "name": "amount", "type": "uint256"}
                            ],
                            "name": "approve",
                            "outputs": [{"internalType": "bool", "name": "", "type": "bool"}],
                            "stateMutability": "nonpayable",
                            "type": "function"
                        }
                    ], tokenB.address);
                    
                    await tokenBContract.methods.approve(contractAddress, amountBWei).send({ from: accounts[0] });
                }
                
                // Add liquidity
                await contract.methods.addLiquidity(
                    tokenA.address,
                    tokenB.address,
                    amountAWei,
                    amountBWei
                ).send({ from: accounts[0] });
                
                alert('Liquidity added successfully!');
                
                // Reset inputs and update balances
                document.getElementById('tokenAAmount').value = '';
                document.getElementById('tokenBAmount').value = '';
                updateBalances();
                loadLiquidityPositions();
                
            } catch (error) {
                console.error("Error adding liquidity:", error);
                alert('Adding liquidity failed: ' + error.message);
            }
        }
        
        // Load liquidity positions (simplified for demo)
        async function loadLiquidityPositions() {
            if (accounts.length === 0) return;
            
            // In a real implementation, you would query the contract for LP positions
            // For this demo, we'll just show a placeholder
            const positionsContainer = document.getElementById('liquidityPositions');
            positionsContainer.innerHTML = '<p class="text-muted text-center">No liquidity positions found</p>';
        }
        
        // Initialize the app when the page loads
        window.addEventListener('load', init);
    </script>
</body>
</html>
