<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SwapAndLiquidity DApp</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
        }
        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .section {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section-title {
            margin-top: 0;
            color: #3498db;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        .connect-wallet {
            background-color: #2ecc71;
        }
        .connect-wallet:hover {
            background-color: #27ae60;
        }
        .result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            background-color: #f8f9fa;
        }
        .error {
            color: #e74c3c;
            margin-top: 10px;
        }
        .success {
            color: #2ecc71;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>SwapAndLiquidity DApp</h1>
    
    <div class="container">
        <div class="section">
            <button id="connectWallet" class="connect-wallet">Connect Wallet</button>
            <div id="walletAddress" class="result"></div>
        </div>
        
        <div class="section">
            <h2 class="section-title">Add Liquidity</h2>
            <div class="form-group">
                <label for="tokenA">Token A Address:</label>
                <input type="text" id="tokenA" placeholder="0x...">
            </div>
            <div class="form-group">
                <label for="amountA">Amount A:</label>
                <input type="number" id="amountA" placeholder="100">
            </div>
            <div class="form-group">
                <label for="tokenB">Token B Address:</label>
                <input type="text" id="tokenB" placeholder="0x...">
            </div>
            <div class="form-group">
                <label for="amountB">Amount B:</label>
                <input type="number" id="amountB" placeholder="100">
            </div>
            <button id="addLiquidity">Add Liquidity</button>
            <div id="liquidityResult" class="result"></div>
            <div id="liquidityError" class="error"></div>
        </div>
        
        <div class="section">
            <h2 class="section-title">Swap Tokens</h2>
            <div class="form-group">
                <label for="fromToken">From Token:</label>
                <input type="text" id="fromToken" placeholder="0x...">
            </div>
            <div class="form-group">
                <label for="toToken">To Token:</label>
                <input type="text" id="toToken" placeholder="0x...">
            </div>
            <div class="form-group">
                <label for="amountIn">Amount In:</label>
                <input type="number" id="amountIn" placeholder="100">
            </div>
            <div class="form-group">
                <label>Estimated Amount Out:</label>
                <div id="estimatedAmountOut" class="result">-</div>
            </div>
            <button id="swapTokens">Swap Tokens</button>
            <div id="swapResult" class="result"></div>
            <div id="swapError" class="error"></div>
        </div>
        
        <div class="section">
            <h2 class="section-title">Pool Reserves</h2>
            <div class="form-group">
                <label for="reserveTokenA">Token A Address:</label>
                <input type="text" id="reserveTokenA" placeholder="0x...">
            </div>
            <div class="form-group">
                <label for="reserveTokenB">Token B Address:</label>
                <input type="text" id="reserveTokenB" placeholder="0x...">
            </div>
            <button id="checkReserves">Check Reserves</button>
            <div id="reservesResult" class="result"></div>
        </div>
    </div>

    <script>
        // Contract ABI
        const contractABI = [
            {
                "inputs": [
                    {"internalType": "address", "name": "tokenA", "type": "address"},
                    {"internalType": "address", "name": "tokenB", "type": "address"},
                    {"internalType": "uint256", "name": "amountA", "type": "uint256"},
                    {"internalType": "uint256", "name": "amountB", "type": "uint256"}
                ],
                "name": "addLiquidity",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {"internalType": "address", "name": "fromToken", "type": "address"},
                    {"internalType": "address", "name": "toToken", "type": "address"},
                    {"internalType": "uint256", "name": "amountIn", "type": "uint256"}
                ],
                "name": "swap",
                "outputs": [{"internalType": "uint256", "name": "amountOut", "type": "uint256"}],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {"internalType": "uint256", "name": "amountIn", "type": "uint256"},
                    {"internalType": "uint256", "name": "reserveIn", "type": "uint256"},
                    {"internalType": "uint256", "name": "reserveOut", "type": "uint256"}
                ],
                "name": "getAmountOut",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "pure",
                "type": "function"
            },
            {
                "inputs": [
                    {"internalType": "address", "name": "", "type": "address"},
                    {"internalType": "address", "name": "", "type": "address"}
                ],
                "name": "reserves",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            }
        ];

        // Contract address - replace with your deployed contract address
        const contractAddress = "0x123..."; // Replace with your actual contract address
        
        let web3;
        let contract;
        let accounts = [];

        // Initialize the application
        async function init() {
            // Check if Web3 is injected by MetaMask
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                try {
                    // Request account access
                    accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    updateWalletUI();
                    
                    // Listen for account changes
                    window.ethereum.on('accountsChanged', (newAccounts) => {
                        accounts = newAccounts;
                        updateWalletUI();
                    });
                } catch (error) {
                    console.error("User denied account access");
                }
            } else {
                alert("Please install MetaMask to use this DApp!");
            }
            
            // Initialize contract
            contract = new web3.eth.Contract(contractABI, contractAddress);
            
            // Set up event listeners
            setupEventListeners();
        }

        function updateWalletUI() {
            const walletElement = document.getElementById('walletAddress');
            if (accounts.length > 0) {
                walletElement.textContent = `Connected: ${accounts[0].substring(0, 6)}...${accounts[0].substring(38)}`;
            } else {
                walletElement.textContent = "Not connected";
            }
        }

        function setupEventListeners() {
            // Connect wallet button
            document.getElementById('connectWallet').addEventListener('click', async () => {
                if (window.ethereum) {
                    try {
                        accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                        updateWalletUI();
                    } catch (error) {
                        console.error("Error connecting wallet:", error);
                    }
                } else {
                    alert("Please install MetaMask to connect your wallet!");
                }
            });

            // Add liquidity button
            document.getElementById('addLiquidity').addEventListener('click', async () => {
                if (accounts.length === 0) {
                    document.getElementById('liquidityError').textContent = "Please connect your wallet first";
                    return;
                }

                const tokenA = document.getElementById('tokenA').value;
                const tokenB = document.getElementById('tokenB').value;
                const amountA = document.getElementById('amountA').value;
                const amountB = document.getElementById('amountB').value;

                if (!tokenA || !tokenB || !amountA || !amountB) {
                    document.getElementById('liquidityError').textContent = "Please fill all fields";
                    return;
                }

                try {
                    document.getElementById('liquidityError').textContent = "";
                    document.getElementById('liquidityResult').textContent = "Processing transaction...";

                    await contract.methods.addLiquidity(
                        tokenA,
                        tokenB,
                        web3.utils.toWei(amountA, 'ether'),
                        web3.utils.toWei(amountB, 'ether')
                    .send({ from: accounts[0] });

                    document.getElementById('liquidityResult').textContent = "Liquidity added successfully!";
                    document.getElementById('liquidityError').textContent = "";
                } catch (error) {
                    console.error("Error adding liquidity:", error);
                    document.getElementById('liquidityError').textContent = "Error: " + error.message;
                    document.getElementById('liquidityResult').textContent = "";
                }
            });

            // Swap tokens button
            document.getElementById('swapTokens').addEventListener('click', async () => {
                if (accounts.length === 0) {
                    document.getElementById('swapError').textContent = "Please connect your wallet first";
                    return;
                }

                const fromToken = document.getElementById('fromToken').value;
                const toToken = document.getElementById('toToken').value;
                const amountIn = document.getElementById('amountIn').value;

                if (!fromToken || !toToken || !amountIn) {
                    document.getElementById('swapError').textContent = "Please fill all fields";
                    return;
                }

                try {
                    document.getElementById('swapError').textContent = "";
                    document.getElementById('swapResult').textContent = "Processing transaction...";

                    const result = await contract.methods.swap(
                        fromToken,
                        toToken,
                        web3.utils.toWei(amountIn, 'ether')
                    ).send({ from: accounts[0] });

                    const amountOut = web3.utils.fromWei(result.events.TokenSwapped.returnValues.amountOut, 'ether');
                    
                    document.getElementById('swapResult').textContent = `Swap successful! Received: ${amountOut}`;
                    document.getElementById('swapError').textContent = "";
                } catch (error) {
                    console.error("Error swapping tokens:", error);
                    document.getElementById('swapError').textContent = "Error: " + error.message;
                    document.getElementById('swapResult').textContent = "";
                }
            });

            // Check reserves button
            document.getElementById('checkReserves').addEventListener('click', async () => {
                const tokenA = document.getElementById('reserveTokenA').value;
                const tokenB = document.getElementById('reserveTokenB').value;

                if (!tokenA || !tokenB) {
                    document.getElementById('reservesResult').textContent = "Please enter both token addresses";
                    return;
                }

                try {
                    const reserveA = await contract.methods.reserves(tokenA, tokenB).call();
                    const reserveB = await contract.methods.reserves(tokenB, tokenA).call();
                    
                    document.getElementById('reservesResult').textContent = 
                        `Reserves:\nToken A: ${web3.utils.fromWei(reserveA, 'ether')}\nToken B: ${web3.utils.fromWei(reserveB, 'ether')}`;
                } catch (error) {
                    console.error("Error checking reserves:", error);
                    document.getElementById('reservesResult').textContent = "Error checking reserves";
                }
            });

            // Calculate estimated amount out when amountIn changes
            document.getElementById('amountIn').addEventListener('input', async () => {
                const fromToken = document.getElementById('fromToken').value;
                const toToken = document.getElementById('toToken').value;
                const amountIn = document.getElementById('amountIn').value;

                if (!fromToken || !toToken || !amountIn) return;

                try {
                    const reserveIn = await contract.methods.reserves(fromToken, toToken).call();
                    const reserveOut = await contract.methods.reserves(toToken, fromToken).call();

                    if (reserveIn > 0 && reserveOut > 0) {
                        const amountOut = await contract.methods.getAmountOut(
                            web3.utils.toWei(amountIn, 'ether'),
                            reserveIn,
                            reserveOut
                        ).call();
                        
                        document.getElementById('estimatedAmountOut').textContent = 
                            web3.utils.fromWei(amountOut, 'ether');
                    } else {
                        document.getElementById('estimatedAmountOut').textContent = "No liquidity";
                    }
                } catch (error) {
                    console.error("Error estimating amount out:", error);
                    document.getElementById('estimatedAmountOut').textContent = "Error";
                }
            });
        }

        // Initialize the app when the page loads
        window.addEventListener('load', init);
    </script>
</body>
</html>